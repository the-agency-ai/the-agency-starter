#!/bin/bash
# GitHub API operations wrapper
#
# Usage:
#   ./tools/gh-api /repos/{owner}/{repo}
#   ./tools/gh-api /repos/{owner}/{repo}/pulls --method POST --field title="PR"
#   ./tools/gh-api graphql -f query='{ viewer { login } }'
#
# This is a convenience wrapper around ./tools/gh api
# All operations are logged via the base gh wrapper.
#
# Related: REQUEST-jordan-0072

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Tool version
TOOL_VERSION="1.0.0-20260120-000001"

# Version check
if [[ "${1:-}" == "--version" || "${1:-}" == "-v" ]]; then
    echo "gh-api $TOOL_VERSION"
    exit 0
fi

# Help
if [[ "${1:-}" == "--help" || "${1:-}" == "-h" ]] || [[ $# -eq 0 ]]; then
    cat << 'EOF'
gh-api - GitHub API operations

Usage:
  ./tools/gh-api <endpoint> [options...]

REST API:
  ./tools/gh-api /repos/{owner}/{repo}
  ./tools/gh-api /repos/{owner}/{repo}/pulls
  ./tools/gh-api /repos/{owner}/{repo}/issues --method POST --field title="Bug"

GraphQL:
  ./tools/gh-api graphql -f query='{ viewer { login } }'
  ./tools/gh-api graphql -f query='query($n:Int!){viewer{repositories(first:$n){nodes{name}}}}' -F n=3

Options:
  --method, -X    HTTP method (GET, POST, PUT, DELETE, PATCH)
  --field, -f     Add a string field
  --raw-field, -F Add a raw field (no JSON escaping)
  --jq            Filter response with jq expression
  --paginate      Fetch all pages
  --silent        Suppress output

Examples:
  ./tools/gh-api /user
  ./tools/gh-api /repos/the-agency-ai/the-agency/pulls --jq '.[].title'
  ./tools/gh-api /repos/{owner}/{repo}/issues --method POST -f title="New issue" -f body="Details"

All operations use ./tools/gh for token injection and logging.
EOF
    exit 0
fi

# Pass through to gh api
exec "$SCRIPT_DIR/gh" api "$@"
